<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- India State Map  -->
    <title>Margin Visualization</title>

    <!--  Scripts  -->
    <script type="text/javascript" src="scripts/d3.v4.js"></script>
    <script src="scripts/queue.js"></script>
    <script type="text/javascript" src="scripts/jquery-3.1.1.min.js"></script>
    <script src="scripts/select2.min.js"></script>
    <link href="css/select2.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">

    <!--  Styles  -->
    <style type="text/css">
    body, html{
      font-family: 'Roboto Condensed', sans-serif;
    }
    svg {
      background: white;
      }
    #up {
      opacity: .8;
      stroke-width: .7;
      }

      .line {
        fill: none;
        stroke-width: 4px;
      }
    .select2{
      margin-left: 40%;
      margin-bottom: 50px;
    }
    </style>
  </head>

<body>
  <div id="chart"></div>

  <select class="js-example-basic-single" style="width:20%;">
  <option value='1'> Behat</option><option value='2'> Nakur</option><option value='3'> Saharanpur Nagar</option><option value='4'> Saharanpur</option><option value='5'> Deoband</option><option value='6'> Rampur Maniharan</option><option value='7'> Gangoh</option><option value='8'> Kairana</option><option value='9'> Thana Bhawan</option><option value='10'> Shamli</option><option value='11'> Budhana</option><option value='12'> Charthawal</option><option value='13'> Purqazi</option><option value='14'> Muzaffar Nagar</option><option value='15'> Khatauli</option><option value='16'> Meerapur</option><option value='17'> Najibabad</option><option value='18'> Nagina</option><option value='19'> Barhapur</option><option value='20'> Dhampur</option><option value='21'> Nehtaur</option><option value='22'> Bijnor</option><option value='23'> Chandpur</option><option value='24'> Noorpur</option><option value='25'> Kanth</option><option value='26'> Thakurdwara</option><option value='27'> Moradabad Rural</option><option value='28'> Moradabad Nagar</option><option value='29'> Kundarki</option><option value='30'> Bilari</option><option value='31'> Chandausi</option><option value='32'> Asmoli</option><option value='33'> Sambhal</option><option value='34'> Suar</option><option value='35'> Chamraua</option><option value='36'> Bilaspur</option><option value='37'> Rampur</option><option value='38'> Milak</option><option value='39'> Dhanaura</option><option value='40'> Naugawan Sadat</option><option value='41'> Amroha</option><option value='42'> Hasanpur</option><option value='43'> Siwalkhas</option><option value='44'> Sardhana</option><option value='45'> Hastinapur</option><option value='46'> Kithore</option><option value='47'> Meerut Cantt.</option><option value='48'> Meerut</option><option value='49'> Meerut South</option><option value='50'> Chhaprauli</option><option value='51'> Baraut</option><option value='52'> Baghpat</option><option value='53'> Loni</option><option value='54'> Muradnagar</option><option value='55'> Sahibabad</option><option value='56'> Ghaziabad</option><option value='57'> Modi Nagar</option><option value='58'> Dholana</option><option value='59'> Hapur</option><option value='60'> Garhmukteshwar</option><option value='61'> Noida</option><option value='62'> Dadri</option><option value='63'> Jewar</option><option value='64'> Sikandrabad</option><option value='65'> Bulandshahr</option><option value='66'> Syana</option><option value='67'> Anupshahr</option><option value='68'> Debai</option><option value='69'> Shikarpur</option><option value='70'> Khurja</option><option value='71'> Khair</option><option value='72'> Barauli</option><option value='73'> Atrauli</option><option value='74'> Chharra</option><option value='75'> Koil</option><option value='76'> Aligarh</option><option value='77'> Iglas</option><option value='78'> Hathras</option><option value='79'> Sadabad</option><option value='80'> Sikandra Rao</option><option value='81'> Chhata</option><option value='82'> Mant</option><option value='83'> Goverdhan</option><option value='84'> Mathura</option><option value='85'> Baldev</option><option value='86'> Etmadpur</option><option value='87'> Agra Cantt.</option><option value='88'> Agra South</option><option value='89'> Agra North</option><option value='90'> Agra Rural</option><option value='91'> Fatehpur Sikri</option><option value='92'> Kheragarh</option><option value='93'> Fatehabad</option><option value='94'> Bah</option><option value='95'> Tundla</option><option value='96'> Jasrana</option><option value='97'> Firozabad</option><option value='98'> Shikohabad</option><option value='99'> Sirsaganj</option><option value='100'> Kasganj</option><option value='101'> Amanpur</option><option value='102'> Patiyali</option><option value='103'> Aliganj</option><option value='104'> Etah</option><option value='105'> Marhara</option><option value='106'> Jalesar</option><option value='107'> Mainpuri</option><option value='108'> Bhongaon</option><option value='109'> Kishani (SC)</option><option value='110'> Karhal</option><option value='111'> Gunnaur</option><option value='112'> Bisauli</option><option value='113'> Sahaswan</option><option value='114'> Bilsi</option><option value='115'> Badaun</option><option value='116'> Shekhupur</option><option value='117'> Dataganj</option><option value='118'> Baheri</option><option value='119'> Meerganj</option><option value='120'> Bhojipura</option><option value='121'> Nawabganj</option><option value='122'> Faridpur</option><option value='123'> Bithari Chainpur</option><option value='124'> Bareilly</option><option value='125'> Bareilly Cantt.</option><option value='126'> Aonla</option><option value='127'> Pilibhit</option><option value='128'> Barkhera</option><option value='129'> Puranpur</option><option value='130'> Bisalpur</option><option value='131'> Katra</option><option value='132'> Jalalabad</option><option value='133'> Tilhar</option><option value='134'> Powayan</option><option value='135'> Shahjahanpur</option><option value='136'> Dadraul</option><option value='137'> PALIA</option><option value='138'> NIGHASAN</option><option value='139'> GOLA GOKRANNATH</option><option value='140'> SRI NAGAR</option><option value='141'> DHAURAHRA</option><option value='142'> LAKHIMPUR</option><option value='143'> KASTA</option><option value='144'> MOHAMMDI</option><option value='145'> Maholi</option><option value='146'> Sitapur</option><option value='147'> Hargaon</option><option value='148'> Laharpur</option><option value='149'> Biswan</option><option value='150'> Sevata</option><option value='151'> Mahmoodabad</option><option value='152'> Sidhauli</option><option value='153'> Misrikh</option><option value='154'> Sawaijpur</option><option value='155'> Shahabad</option><option value='156'> Hardoi</option><option value='157'> Gopamau</option><option value='158'> Sandi</option><option value='159'> Bilgram-Mallanwan</option><option value='160'> Balamau</option><option value='161'> Sandila</option><option value='162'> Bangermau</option><option value='163'> Safipur</option><option value='164'> Mohan</option><option value='165'> Unnao</option><option value='166'> Bhagwantnagar</option><option value='167'> Purwa</option><option value='168'> Malihabad</option><option value='169'> Bakshi Kaa Talab</option><option value='170'> Sarojini Nagar</option><option value='171'> Lucknow West</option><option value='172'> Lucknow North</option><option value='173'> Lucknow East</option><option value='174'> Lucknow Central</option><option value='175'> 175-LUCKNOW CANTT.</option><option value='176'> Mohanlalganj</option><option value='177'> Bachhrawan</option><option value='178'> Tiloi</option><option value='179'> Harchandpur</option><option value='180'> Rae Bareli</option><option value='181'> Salon</option><option value='182'> Sareni</option><option value='183'> Unchahar</option><option value='184'> Jagdishpur</option><option value='185'> Gauriganj</option><option value='186'> Amethi</option><option value='187'> Isauli</option><option value='188'> Sultanpur</option><option value='189'> Sadar</option><option value='190'> Lambhua</option><option value='191'> Kadipur</option><option value='192'> Kaimganj</option><option value='193'> Amritpur</option><option value='194'> Farrukhabad</option><option value='195'> Bhojpur</option><option value='196'> Chhibramau</option><option value='197'> Tirwa</option><option value='198'> Kannauj</option><option value='199'> Jaswantnagar</option><option value='200'> Etawah</option><option value='201'> Bharthana</option><option value='202'> Bidhuna</option><option value='203'> Dibiyapur</option><option value='204'> Auraiya</option><option value='205'> Rasulabad</option><option value='206'> Akbarpur - Raniya</option><option value='207'> Sikandra</option><option value='208'> Bhognipur</option><option value='209'> Bilhaur</option><option value='210'> Bithoor</option><option value='211'> Kalyanpur</option><option value='212'> Govindnagar</option><option value='213'> Sishamau</option><option value='214'> Arya Nagar</option><option value='215'> KIDWAI NAGAR</option><option value='216'> Kanpur Cantt.</option><option value='217'> Maharajpur</option><option value='218'> Ghatampur</option><option value='219'> Madhaugarh</option><option value='220'> Kalpi</option><option value='221'> Orai</option><option value='222'> Babina</option><option value='223'> Jhansi Nagar</option><option value='224'> Mauranipur</option><option value='225'> Garautha</option><option value='226'> Lalitpur</option><option value='227'> Mehroni</option><option value='228'> Hamirpur</option><option value='229'> Rath</option><option value='230'> Mahoba</option><option value='231'> Charkhari</option><option value='232'> Tindwari</option><option value='233'> Baberu</option><option value='234'> Naraini</option><option value='235'> Banda</option><option value='236'> Chitrakoot</option><option value='237'> Manikpur</option><option value='238'> Jahanabad</option><option value='239'> Bindki</option><option value='240'> Fatehpur</option><option value='241'> Ayah Shah</option><option value='242'> Husainganj</option><option value='243'> Khaga</option><option value='244'> Rampur Khas</option><option value='245'> Babaganj</option><option value='246'> Kunda</option><option value='247'> Vishwanathganj</option><option value='248'> Pratapgarh</option><option value='249'> Patti</option><option value='250'> Raniganj</option><option value='251'> Sirathu</option><option value='252'> Manjhanpur</option><option value='253'> Chail</option><option value='254'> Phaphamau</option><option value='255'> Soraon</option><option value='256'> Phulpur</option><option value='257'> Pratappur</option><option value='258'> Handia</option><option value='259'> Meja</option><option value='260'> Karachhana</option><option value='261'> Allahabad West</option><option value='262'> Allahabad North</option><option value='263'> Allahabad South</option><option value='264'> Bara</option><option value='265'> Koraon</option><option value='266'> Kursi</option><option value='267'> Ram Nagar</option><option value='268'> Barabanki</option><option value='269'> Zaidpur</option><option value='270'> Dariyabad</option><option value='271'> Rudauli</option><option value='272'> Haidergarh</option><option value='273'> Milkipur</option><option value='274'> Bikapur</option><option value='275'> Ayodhya</option><option value='276'> Goshainganj</option><option value='277'> Katehari</option><option value='278'> Tanda</option><option value='279'> Alapur</option><option value='280'> Jalalpur</option><option value='281'> Akbarpur</option><option value='282'> BALHA (S.C.)</option><option value='283'> Nanpara</option><option value='284'> Matera</option><option value='285'> Mahasi</option><option value='286'> Bahraich</option><option value='287'> Payagpur</option><option value='288'> Kaiserganj</option><option value='289'> Bhinga</option><option value='290'> Shrawasti</option><option value='291'> Tulsipur</option><option value='292'> Gainsari</option><option value='293'> Utraula</option><option value='294'> Balrampur</option><option value='295'> Mehnaun</option><option value='296'> Gonda</option><option value='297'> Katra Bazar</option><option value='298'> Colonelganj</option><option value='299'> Tarabganj</option><option value='300'> Mankapur</option><option value='301'> Gaura</option><option value='302'> Shohratgarh</option><option value='303'> Kapilvastu</option><option value='304'> Bansi</option><option value='305'> Itwa</option><option value='306'> Doomariyaganj</option><option value='307'> Harraiya</option><option value='308'> Kaptanganj</option><option value='309'> Rudhauli</option><option value='310'> Basti Sadar</option><option value='311'> Mahadewa S.C</option><option value='312'> MENHDAWAL</option><option value='313'> KHALILABAD</option><option value='314'> Dhanghata</option><option value='315'> Pharenda</option><option value='316'> Nautanwa</option><option value='317'> Siswa</option><option value='318'> Maharajganj</option><option value='319'> Paniyara</option><option value='320'> Caimpiyarganj</option><option value='321'> Pipraich</option><option value='322'> Gorakhpur Urban</option><option value='323'> Gorakhpur Rural</option><option value='324'> Sahajanwa</option><option value='325'> Khajani</option><option value='326'> Chauri-Chaura</option><option value='327'> Bansgaon</option><option value='328'> Chillupar</option><option value='329'> Khadda</option><option value='330'> Padrauna</option><option value='331'> Tamkuhi Raj</option><option value='332'> Fazilnagar</option><option value='333'> Kushinagar</option><option value='334'> Hata</option><option value='335'> Ramkola</option><option value='336'> Rudrapur</option><option value='337'> Deoria</option><option value='338'> Pathardeva</option><option value='339'> Rampur Karkhana</option><option value='340'> Bhatpar Rani</option><option value='341'> Salempur</option><option value='342'> Barhaj</option><option value='343'> Atrauliya</option><option value='344'> Gopalpur</option><option value='345'> Sagri</option><option value='346'> Mubarakpur</option><option value='347'> Azamgarh</option><option value='348'> Nizamabad</option><option value='349'> Phoolpur Pawai</option><option value='350'> Didarganj</option><option value='351'> Lalganj</option><option value='352'> Mehnagar</option><option value='353'> Madhuban</option><option value='354'> Ghosi</option><option value='355'> Muhammadabad- Gohna (SC)</option><option value='356'> Mau</option><option value='357'> Belthara Road</option><option value='358'> Rasara</option><option value='359'> Sikanderpur</option><option value='360'> Phephana</option><option value='361'> Ballia Nagar</option><option value='362'> Bansdih</option><option value='363'> Bairia</option><option value='364'> Badlapur</option><option value='365'> Shahganj</option><option value='366'> Jaunpur</option><option value='367'> Malhani</option><option value='368'> Mungra Badshahpur</option><option value='369'> Machhlishahr S.C.</option><option value='370'> Mariyahu</option><option value='371'> Zafrabad</option><option value='372'> Kerakat S.C.</option><option value='373'> Jakhanian</option><option value='374'> Saidpur</option><option value='375'> Ghazipur</option><option value='376'> Jangipur</option><option value='377'> Zahoorabad</option><option value='378'> Mohammadabad</option><option value='379'> Zamania</option><option value='380'> Mughalsarai</option><option value='381'> Sakaldiha</option><option value='382'> Saiyadraja</option><option value='383'> Chakia</option><option value='384'> Pindra</option><option value='385'> Ajagara</option><option value='386'> Shivpur</option><option value='387'> Rohaniya</option><option value='388'> Varanasi North</option><option value='389'> Varanasi South</option><option value='390'> Varanasi Cantt.</option><option value='391'> Sevapuri</option><option value='392'> Bhadohi</option><option value='393'> Gyanpur</option><option value='394'> Aurai</option><option value='395'> Chhanbey</option><option value='396'> Mirzapur</option><option value='397'> Majhawan</option><option value='398'> Chunar</option><option value='399'> Marihan</option><option value='400'> Ghorawal</option><option value='401'> Robertsganj</option><option value='402'> Obra</option><option value='403'> Duddhi</option>"
  </select>

  <script type="text/javascript">
  var party_colors = {
      'INC': '#0392cf', // blue
      'BJP': '#f37736', // orange
      'SP':  '#ee4035', // red
      'BSP': '#7bc043', // green
      'IND': '#65737e'
  }
  var width = document.body.clientWidth*0.90,
      height = 400;
  var card_circle_radius = 9;
  var selected_const_code = 0;
  var svg = d3.select('#chart').append('svg')
      .attr('width', document.body.clientWidth)
      .attr('height', height);
  queue()
      .defer(d3.csv, 'data/margins/2002.csv')
      .defer(d3.csv, 'data/margins/2007.csv')
      .defer(d3.csv, 'data/margins/2012.csv')
      .defer(d3.csv, 'data/margins/2017.csv')
      .await(makeMyMap);
  function makeMyMap(error, data_2002, data_2007, data_2012, data_2017) {
      //Add years texts
      for (var i = 0; i < 4; i++) {
          svg.append('text')
              .attr('x', 30)
              .attr('y', height * (1-(i + 0.5) / 4) + 5)
              .attr('text-anchor', 'start')
              .style("font-size","13px")
              .text(2002 + i * 5);
      }

      // Important ! domain is given manually
      margin_scale_2002 = d3.scaleLinear().domain([26, 183899]).range([75, width]);
      margin_scale_2007 = d3.scaleLinear().domain([9, 53128]).range([75, width]);
      margin_scale_2012 = d3.scaleLinear().domain([18, 88255]).range([75, width]);
      margin_scale_2017 = d3.scaleLinear().domain([171, 150685]).range([75, width]);
      //add cards horizontally
      highlight_line = svg.append("path")
          .datum(create_path(1))
          .attr("class", "line")
          .attr("d", d3.line()
            //.curve(d3.curveBundle.beta(1))
            .curve(d3.curveMonotoneY)
            .x(function(d) { return d[0]; })
            .y(function(d) { return d[1]; })
          )
            .style('stroke', 'transparent')
            .style('opacity', 0.5);

      var year_scale_functions = [
        {"func":margin_scale_2017, "data":data_2017},
        {"func":margin_scale_2012, "data":data_2012},
        {"func":margin_scale_2007, "data":data_2007},
        {"func":margin_scale_2002, "data":data_2002},
      ];
      var info_cards = []; //Svg group which stores margins, names, etc
      year_scale_functions.forEach(function(year, i){
        for (var j = 0; j < 403; j++) {
            //Create cards for each datapoint
            card = svg.append('g').on('mouseover', highlight)
                //.on('mouseout', normalCard)
                .attr('id', 'yr'+(2017 - 5*i)+'id'+j);
            card.append('rect')
                .attr("x", 5)
                .attr("y", 0)
                .attr("width", 10)
                .attr("height", height / 4)
                .attr('fill', 'transparent');
            card.append('circle')
                .attr('cx', 10)
                .attr('cy', height / 8)
                .attr('r', card_circle_radius)
                .attr('fill', function(){
                  if (party_colors[year.data[j]['win_party']]){
                    return party_colors[year.data[j]['win_party']];
                  } else{
                    return '#65737e';
                  }
                })
                .attr('opacity', 0.25);
            card.attr("transform", "translate(" + (year.func(year.data[j]['margin'])-5) + ", "+ (height*(i/4)) +")");
        }
        info_cards.push(
          svg.append('g').attr('id', 'info'+(2017 - 5*i))
        );
        info_cards[i].append('text')
            .attr('id', 'yr'+(2017 - 5*i) + 'info_right_top')
            .attr('x', 30)
            .attr('y', height/4 - height/8 - 15)
            .attr('text-anchor', 'start')
            .text('')
            .style("font-size","30px")
            .style('fill', 'transparent');
          info_cards[i].append('text')
            .attr('id', 'yr'+(2017 - 5*i) + 'info_left')
            .attr('x', -10)
            .attr('y', height/4 - height/8 - 15)
            .attr('text-anchor', 'end')
            .text('')
            .style("font-size","30px")
            .style('fill', 'transparent');
          info_cards[i].append('text')
            .attr('id', 'yr'+(2017 - 5*i) + 'info_left_bottom')
            .attr('x', 30)
            .attr('y', height/4 - height/8 + 37)
            .attr('text-anchor', 'start')
            .style("font-size","30px")
            .text('')
            .style('fill', 'transparent');
      });

      function highlight(){
        normalCard();
        selected_const_code = parseInt(this.getAttribute('id').split('id')[1]);
        $(".js-example-basic-single").val(selected_const_code + 1).change();
        highlight_line.datum(create_path(selected_const_code))
            .attr("class", "line")
            .attr("d", d3.line()
              .curve(d3.curveBundle.beta(1))
              .x(function(d) { return d[0]; })
              .y(function(d) { return d[1]; })
            )
            .style('stroke', '#c0c5ce');
        for(var i = 0; i<4; i++){
          highlightCard(document.getElementById('yr'+(2002 + 5*i)+ 'id' + selected_const_code));
        }
      }
      function highlightCard(c) {
          d3.select(c).moveToFront();
          d3.select(c.getElementsByTagName("circle")[0])
              .attr('r', card_circle_radius + 5)
              .attr('opacity', 1);

          year_scale_functions.forEach(function(year, i){
            info_cards[i].attr("transform", "translate(" + (year.func(year.data[selected_const_code]['margin'])-5) + ", "+ (height*(i/4)) +")");
            d3.select(document.getElementById('yr'+(2017 - 5*i)+ 'info_right_top')).text(year.data[selected_const_code]['win_votes'])
              .style('fill', function(){
                if (party_colors[year.data[selected_const_code]['win_party']]){
                  return party_colors[year.data[selected_const_code]['win_party']];
                } else{
                  return '#65737e';
                }
              });
            d3.select(document.getElementById('yr'+(2017 - 5*i)+ 'info_left')).text(year.data[selected_const_code]['margin']).style('fill', '#65737e');
            d3.select(document.getElementById('yr'+(2017 - 5*i)+ 'info_left_bottom')).text(year.data[selected_const_code]['second_votes'])
              .style('fill', function(){
                if (party_colors[year.data[selected_const_code]['second_party']]){
                  return party_colors[year.data[selected_const_code]['second_party']];
                } else{
                  return '#65737e';
                }
              });
          });
      }
      function normalCard() {
        for(var i = 0; i<4; i++){
          d3.select(document.getElementById('yr'+(2002 + 5*i)+ 'id' + selected_const_code).getElementsByTagName("circle")[0])
            .attr('r', card_circle_radius)
            .attr('opacity', 0.5);
        }
      }
      function create_path(i){
        var path_array = [];
        path_array.push([margin_scale_2017(data_2017[i]['margin']) + 5, height/8]);
        path_array.push([margin_scale_2017(data_2017[i]['margin']) + 5, height/8*2 - 10]);
        path_array.push([margin_scale_2017(data_2017[i]['margin']) + 5, height/8*2 - 5]);

        var d1 = margin_scale_2017(data_2017[i]['margin']) + 5;
        var d2 = margin_scale_2012(data_2012[i]['margin']) + 5;
        path_array.push([d1+Math.sign(d2-d1)*d3.min([5,Math.abs((d2-d1))]), height/8*2]);
        path_array.push([(d1+d2)/2, height/8*2]);
        path_array.push([d2-Math.sign(d2-d1)*d3.min([5,Math.abs((d2-d1))]), height/8*2]);

        path_array.push([margin_scale_2012(data_2012[i]['margin']) + 5, height/8*2 + 5]);
        path_array.push([margin_scale_2012(data_2012[i]['margin']) + 5, height/8*2 + 10]);
        path_array.push([margin_scale_2012(data_2012[i]['margin']) + 5, height/8*3]);
        path_array.push([margin_scale_2012(data_2012[i]['margin']) + 5, height/8*4 - 10]);
        path_array.push([margin_scale_2012(data_2012[i]['margin']) + 5, height/8*4 - 5]);

        d1 = margin_scale_2012(data_2012[i]['margin']) + 5;
        d2 = margin_scale_2007(data_2007[i]['margin']) + 5;
        path_array.push([d1+Math.sign(d2-d1)*d3.min([5,Math.abs((d2-d1))]), height/8*4]);
        path_array.push([(d1+d2)/2, height/8*4]);
        path_array.push([d2-Math.sign(d2-d1)*d3.min([5,Math.abs((d2-d1))]), height/8*4]);

        path_array.push([margin_scale_2007(data_2007[i]['margin']) + 5, height/8*4 + 5]);
        path_array.push([margin_scale_2007(data_2007[i]['margin']) + 5, height/8*4 + 10]);
        path_array.push([margin_scale_2007(data_2007[i]['margin']) + 5, height/8*5]);
        path_array.push([margin_scale_2007(data_2007[i]['margin']) + 5, height/8*6 - 10]);
        path_array.push([margin_scale_2007(data_2007[i]['margin']) + 5, height/8*6 - 5]);

        d1 = margin_scale_2007(data_2007[i]['margin']) + 5;
        d2 = margin_scale_2002(data_2002[i]['margin']) + 5;
        path_array.push([d1+Math.sign(d2-d1)*d3.min([5,Math.abs((d2-d1))]), height/8*6]);
        path_array.push([(d1+d2)/2, height/8*6]);
        path_array.push([d2-Math.sign(d2-d1)*d3.min([5,Math.abs((d2-d1))]), height/8*6]);

        path_array.push([margin_scale_2002(data_2002[i]['margin']) + 5, height/8*6 + 5]);
        path_array.push([margin_scale_2002(data_2002[i]['margin']) + 5, height/8*6 + 10]);
        path_array.push([margin_scale_2002(data_2002[i]['margin']) + 5, height/8*7]);
        return path_array;
      }
      d3.selection.prototype.moveToFront = function() {
        return this.each(function(){
          this.parentNode.appendChild(this);
        });
      };
      $(".js-example-basic-single").select2();
      $(".js-example-basic-single").on("change", function() {
        normalCard();
        selected_const_code = parseInt($(this).val()) - 1;
        highlight_line.datum(create_path(selected_const_code))
            .attr("class", "line")
            .attr("d", d3.line()
              .curve(d3.curveBundle.beta(1))
              .x(function(d) { return d[0]; })
              .y(function(d) { return d[1]; })
            )
            .style('stroke', '#c0c5ce');
        for(var i = 0; i<4; i++){
          highlightCard(document.getElementById('yr'+(2002 + 5*i)+ 'id' + selected_const_code));
        }
      });
      $(".js-example-basic-single").val("1").change();
  }
  </script>
</body>
</html>
